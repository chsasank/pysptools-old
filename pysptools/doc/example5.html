<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Convex hull and features extraction &mdash; PySptools 0.13.4 beta documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.13.4 beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PySptools 0.13.4 beta documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PySptools 0.13.4 beta documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="convex-hull-and-features-extraction">
<h1>Convex hull and features extraction<a class="headerlink" href="#convex-hull-and-features-extraction" title="Permalink to this headline">Â¶</a></h1>
<p>This is a quick overview of the convex hull removal and features extraction functions. They are part of the spectro module.</p>
<p>The overall goal is to extract the spectrum features. To identify a spectral feature by its wavelength position and shape, it must be isolated from effects like level changes and slopes. The first step is to normalize the spectrum by applying it a continuum removal algorithm. There is two ways of doing it: by division in reflectance, transmittance, and emittance spectra or by subtraction with absorbance or absorption coefficient spectra. The former is what is implemented by the pysptools library (see <em>SpectrumConvexHullQuotient</em> class).</p>
<p>The script listed below open the USGS 2006 library and read four spectra. They are:</p>
<blockquote>
<div><ul class="simple">
<li>Biotite WS660</li>
<li>Chalcedony CU91-6A</li>
<li>Kaolinite CM7</li>
<li>Gibbsite HS423.3B</li>
</ul>
</div></blockquote>
<p>Next, the script compute the convex hull removal algorithm on these spectra. For the results, see figure 1.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="_images/chull_ch.png"><img alt="None" src="_images/chull_ch.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 1: continuum removed spectra.</span></p>
</div>
<p>When the convex hull is removed, the absorption features can be isolated and identified. In fact, a call to the init class method <em>FeaturesConvexHullQuotient()</em> do all the job in one call. The next figures shows, for each spectrum, the features extracted. The number of features extracted can be controled by ajusting the baseline parameter. This parameter may be different spectrum by spectrum. The class <em>FeaturesConvexHullQuotient</em> have a method to output the features statistics.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/chull_gibbsite_features.png"><img alt="None" src="_images/chull_gibbsite_features.png" style="width: 640.0px; height: 240.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 2: features for the gibbsite sample.</span></p>
</div>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/chull_kaolinite_features.png"><img alt="None" src="_images/chull_kaolinite_features.png" style="width: 960.0px; height: 240.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 3: features for the kaolinite sample.</span></p>
</div>
<p>The code follow:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plot the convex hull and the features for 4 substances.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pysptools.spectro</span> <span class="kn">as</span> <span class="nn">spectro</span>


<span class="k">class</span> <span class="nc">SpecLib</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib_name</span><span class="p">):</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">spectro</span><span class="o">.</span><span class="n">EnviReader</span><span class="p">(</span><span class="n">lib_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">spectro</span><span class="o">.</span><span class="n">USGS06SpecLib</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">sample_id</span><span class="p">,</span> <span class="n">descrip</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">get_substance</span><span class="p">(</span><span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">spectrum</span>

    <span class="k">def</span> <span class="nf">get_wvl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">get_wvl</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_convex_hull</span><span class="p">(</span><span class="n">path_out</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
    <span class="n">wvl</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">get_wvl</span><span class="p">()</span>

    <span class="n">schq</span> <span class="o">=</span> <span class="n">spectro</span><span class="o">.</span><span class="n">SpectrumConvexHullQuotient</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">wvl</span><span class="p">)</span>
    <span class="n">plot_name</span> <span class="o">=</span> <span class="s">&#39;{0}_{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
    <span class="n">schq</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">path_out</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span><span class="n">path_out</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process the s06av95a_envi file and extract the &lt;substance&gt; and/or &lt;sample&gt;</span>
<span class="sd">    features according to the &lt;baseline&gt; value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
    <span class="n">wvl</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">get_wvl</span><span class="p">()</span>
    <span class="n">fea</span> <span class="o">=</span> <span class="n">spectro</span><span class="o">.</span><span class="n">FeaturesConvexHullQuotient</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">wvl</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">)</span>
    <span class="n">plot_name</span> <span class="o">=</span> <span class="s">&#39;{0}_{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
    <span class="n">fea</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">path_out</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">)</span>


<span class="n">substances</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;Biotite&#39;</span><span class="p">,</span> <span class="s">&#39;WS660&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Chalcedony&#39;</span><span class="p">,</span> <span class="s">&#39;CU91-6A&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Kaolinite&#39;</span><span class="p">,</span> <span class="s">&#39;CM7&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Gibbsite&#39;</span><span class="p">,</span> <span class="s">&#39;HS423.3B&#39;</span><span class="p">)]</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PYSPTOOLS_USGS&#39;</span><span class="p">]</span>
    <span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;HOME&#39;</span><span class="p">]</span>
    <span class="n">result_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home</span><span class="p">,</span> <span class="s">&#39;results&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span>

    <span class="n">hdr_name</span> <span class="o">=</span> <span class="s">&#39;s06av95a_envi.hdr&#39;</span>
    <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">hdr_name</span><span class="p">)</span>

    <span class="n">lib</span> <span class="o">=</span> <span class="n">SpecLib</span><span class="p">(</span><span class="n">lib_path</span><span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="mf">0.93</span>
    <span class="k">for</span> <span class="n">substance</span><span class="p">,</span><span class="n">sample</span> <span class="ow">in</span> <span class="n">substances</span><span class="p">:</span>
        <span class="n">plot_convex_hull</span><span class="p">(</span><span class="n">result_path</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
        <span class="n">extract_features</span><span class="p">(</span><span class="n">result_path</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">substance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PySptools 0.13.4 beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013-2016, Christian Therien.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>