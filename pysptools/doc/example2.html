<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Methanol gas synthetic images &mdash; PySptools 0.13.4 beta documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.13.4 beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PySptools 0.13.4 beta documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PySptools 0.13.4 beta documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="methanol-gas-synthetic-images">
<h1>Methanol gas synthetic images<a class="headerlink" href="#methanol-gas-synthetic-images" title="Permalink to this headline">Â¶</a></h1>
<p>In general endmembres extracted from a cube give usefull information but only some endmembers can be used at the classification step. In fact, many things can influence a HSI cube analysis. For this example we take a cube that is very unmixing friendly.</p>
<p>Figure 1 show the object, a small methanol burner. Methanol gas exit the burner. The cube is acquired in the VLW range of infrared, between 867 to 1288 wavenumber (cm-1) (7.76 to 11.54 micrometer) and it have 165 bands. The instrument used to acquire the data come from the Telops compagny. IR spectra are characteristic for chemical compounds, and their intensities are proportional to the concentration. It is what we show here. Unmixing give a fine-grained overview of the concentration.</p>
<p>The first step consist to extract the endmembers. The algorithm used is NFINDR with the initial working set initialized with ATGP. One of the good thing with using ATGP to create the initial working set is that this made NFINDR deterministic. Running it again with the same parameters give the same endmembers set. It is helpfull when we compare different result sets obtained with different parametrization. Figure 2 present the result set obtained by running NFINDR. For this case, twelve endmembers extracted was a good compromise. They give the information needed.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="_images/bur_burner_visible.png"><img alt="none" src="_images/bur_burner_visible.png" style="width: 155.0px; height: 148.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 1, a small methanol burner.</span></p>
</div>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href=".\bur\bur_endmembers.png"><img alt="none" src=".\bur\bur_endmembers.png" /></a>
<p class="caption"><span class="caption-text">Figure 2, the twelve endmembers extracted.</span></p>
</div>
<p>The second step consist to generate the abundance maps from the extracted endmembers. To present the result, the twelve abundance maps are grouped by related field: the burner (figure 3), the gas escaping the burner by the side (figure 4), the gas escaping the burner by the top (figure 5) and the backgournd (figure 6). The standard interpretation for the gas leaving by the side is a reflection of the gas leaving by the top on the burner&#8217;s metallic casing. Is it a reflection or the unmixing can detect the gas leaving by the side, I don&#8217;t no. But, a combination of both is a good hypothesis.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/bur_burner.png"><img alt="none" src="_images/bur_burner.png" style="width: 400.0px; height: 150.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 3, abundance maps related to the burner.</span></p>
</div>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="_images/bur_gas_around.png"><img alt="none" src="_images/bur_gas_around.png" style="width: 600.0px; height: 150.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 4, abundance maps related to gas leaving the burner by the side (or a reflection).</span></p>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/bur_gas_above1.png"><img alt="none" src="_images/bur_gas_above1.png" style="width: 400.0px; height: 150.0px;" /></a>
</div>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="_images/bur_gas_above2.png"><img alt="none" src="_images/bur_gas_above2.png" style="width: 400.0px; height: 150.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 5, abundance maps related to gas leaving the burner by the top.</span></p>
</div>
<div class="figure align-center" id="id6">
<a class="reference internal image-reference" href="_images/bur_background.png"><img alt="none" src="_images/bur_background.png" style="width: 600.0px; height: 150.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 6, background abundance maps.</span></p>
</div>
<p>Finally, the synthetic images are generated by first applying a threshold and after adding the related abundance maps. The figure 7 is the burner synthetic image, the figure 8 the gas leaving by the side and figure 9 by the top.</p>
<div class="figure align-center" id="id7">
<a class="reference internal image-reference" href="_images/bur_synthetic_burner.png"><img alt="none" src="_images/bur_synthetic_burner.png" style="width: 400.0px; height: 300.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 7, the burner synthetic image.</span></p>
</div>
<div class="figure align-center" id="id8">
<a class="reference internal image-reference" href="_images/bur_synthetic_gas_around.png"><img alt="none" src="_images/bur_synthetic_gas_around.png" style="width: 400.0px; height: 300.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 8, synthetic image of the gas leaving the burner&#8217;s side (or a reflection or both).</span></p>
</div>
<div class="figure align-center" id="id9">
<a class="reference internal image-reference" href="_images/bur_synthetic_gas_above.png"><img alt="none" src="_images/bur_synthetic_gas_above.png" style="width: 400.0px; height: 300.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 9: synthetic image of the gas leaving by the top.</span></p>
</div>
<p>The code follow:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plot abundance maps stack for the methanol gas HSI cube.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">osp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pysptools.util</span> <span class="kn">as</span> <span class="nn">util</span>
<span class="kn">import</span> <span class="nn">pysptools.eea</span> <span class="kn">as</span> <span class="nn">eea</span>
<span class="kn">import</span> <span class="nn">pysptools.abundance_maps</span> <span class="kn">as</span> <span class="nn">amp</span>


<span class="k">def</span> <span class="nf">parse_ENVI_header</span><span class="p">(</span><span class="n">head</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ax</span><span class="p">[</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">head</span><span class="p">[</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Wavelength - &#39;</span><span class="o">+</span><span class="n">head</span><span class="p">[</span><span class="s">&#39;z plot titles&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">head</span><span class="p">[</span><span class="s">&#39;z plot titles&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span> <span class="nf">get_endmembers</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">result_path</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Endmembers extraction with NFINDR&#39;</span><span class="p">)</span>
    <span class="n">nfindr</span> <span class="o">=</span> <span class="n">eea</span><span class="o">.</span><span class="n">NFINDR</span><span class="p">()</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">nfindr</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">maxit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ATGP_init</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">nfindr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result_path</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">&#39;gas&#39;</span><span class="p">)</span>
    <span class="c"># return an array of endmembers</span>
    <span class="k">return</span> <span class="n">U</span>


<span class="k">def</span> <span class="nf">gen_abundance_maps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">result_path</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Abundance maps generation with NNLS&#39;</span><span class="p">)</span>
    <span class="n">nnls</span> <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">NNLS</span><span class="p">()</span>
    <span class="n">amaps</span> <span class="o">=</span> <span class="n">nnls</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">nnls</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result_path</span><span class="p">,</span> <span class="n">colorMap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">&#39;gas&#39;</span><span class="p">)</span>
    <span class="c"># return an array of abundance maps</span>
    <span class="k">return</span> <span class="n">amaps</span>


<span class="k">def</span> <span class="nf">plot_synthetic_gas_above</span><span class="p">(</span><span class="n">amap</span><span class="p">,</span> <span class="n">colormap</span><span class="p">,</span> <span class="n">result_path</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Create and plot synthetic map for the gas_above&#39;</span><span class="p">)</span>
    <span class="n">gas</span> <span class="o">=</span> <span class="p">(</span><span class="n">amap</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">amap</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">gas</span><span class="p">[:,:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">gas</span><span class="p">[:,:,</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">gas</span><span class="p">[:,:,</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">gas</span><span class="p">[:,:,</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">plot_synthetic_image</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">colormap</span><span class="p">,</span> <span class="s">&#39;gas_above&#39;</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_synthetic_gas_around</span><span class="p">(</span><span class="n">amap</span><span class="p">,</span> <span class="n">colormap</span><span class="p">,</span> <span class="n">result_path</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Create and plot synthetic map for the gas_around&#39;</span><span class="p">)</span>
    <span class="n">gas</span> <span class="o">=</span> <span class="p">(</span><span class="n">amap</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">amap</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">gas</span><span class="p">[:,:,</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">gas</span><span class="p">[:,:,</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="n">gas</span><span class="p">[:,:,</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">plot_synthetic_image</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">colormap</span><span class="p">,</span> <span class="s">&#39;gas_around&#39;</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_synthetic_burner</span><span class="p">(</span><span class="n">amap</span><span class="p">,</span> <span class="n">colormap</span><span class="p">,</span> <span class="n">result_path</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Create and plot synthetic map for the burner&#39;</span><span class="p">)</span>
    <span class="n">burner</span> <span class="o">=</span> <span class="p">(</span><span class="n">amap</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">amap</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">burner</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">burner</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">plot_synthetic_image</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">colormap</span><span class="p">,</span> <span class="s">&#39;burner&#39;</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_synthetic_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">colormap</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">result_path</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">img</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">fout</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_path</span><span class="p">,</span> <span class="s">&#39;synthetic_{0}.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Load the cube</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PYSPTOOLS_DATA&#39;</span><span class="p">]</span>
    <span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;HOME&#39;</span><span class="p">]</span>

    <span class="n">sample</span> <span class="o">=</span> <span class="s">&#39;burner.hdr&#39;</span>
    <span class="n">data_file</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">load_ENVI_file</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

    <span class="n">result_path</span> <span class="o">=</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home</span><span class="p">,</span> <span class="s">&#39;results&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">osp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">result_path</span><span class="p">)</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="n">parse_ENVI_header</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

    <span class="c"># Telops cubes are flipped left-right</span>
    <span class="c"># Flipping them again restore the orientation</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">U</span> <span class="o">=</span> <span class="n">get_endmembers</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>
    <span class="n">amaps</span> <span class="o">=</span> <span class="n">gen_abundance_maps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>
    <span class="c"># best color maps: hot and spectral</span>
    <span class="n">plot_synthetic_gas_above</span><span class="p">(</span><span class="n">amaps</span><span class="p">,</span> <span class="s">&#39;spectral&#39;</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>
    <span class="n">plot_synthetic_gas_around</span><span class="p">(</span><span class="n">amaps</span><span class="p">,</span> <span class="s">&#39;hot&#39;</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>
    <span class="n">plot_synthetic_burner</span><span class="p">(</span><span class="n">amaps</span><span class="p">,</span> <span class="s">&#39;hot&#39;</span><span class="p">,</span> <span class="n">result_path</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PySptools 0.13.4 beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013-2016, Christian Therien.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>